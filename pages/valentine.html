<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Patrick+Hand&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- GLOBAL THEME (Solid Colors, No Gradients) --- */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Patrick Hand', cursive;
            background-color: #FFFDF5; /* Creamy Paper Background */
            color: #5D4037; /* Warm Brown Text */
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        .back-btn {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; color: #D32F2F;
            background: white; border: 2px solid #FFCDD2;
            padding: 8px 15px; border-radius: 20px;
            font-weight: bold; z-index: 100;
            box-shadow: 3px 3px 0px #FFCDD2;
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            text-align: center;
            color: #D32F2F; /* Deep Red */
            margin: 10px 0 20px 0;
            font-size: 2.5rem;
        }

        /* --- PAGE SECTIONS --- */
        .page-section {
            display: none;
            width: 100%;
            min-height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 1s ease;
        }
        .page-section.active { display: flex; opacity: 1; }

        /* --- STAGE 1: THE PUZZLE --- */
        .puzzle-frame {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 0 #E0E0E0; /* 3D Solid Shadow */
            border: 4px solid #5D4037;
        }

        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 2px;
            background: #FFCDD2;
            border: 2px solid #5D4037;
        }

        .puzzle-piece {
            width: 100px; height: 100px;
            background-image: url('puzzle-image.jpg'); /* YOUR PHOTO HERE */
            background-size: 300px 300px;
            cursor: grab;
            transition: transform 0.2s;
            /* Placeholder color if image fails */
            background-color: #FF8A80; 
        }
        .puzzle-piece:active { cursor: grabbing; transform: scale(1.05); z-index: 10; }

        .progress-box {
            width: 320px; margin-top: 25px; text-align: center;
        }
        .progress-bar-bg {
            width: 100%; height: 20px;
            background: #FFE0B2; border-radius: 10px;
            border: 2px solid #5D4037; overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%; width: 0%;
            background: #FF7043; transition: width 0.3s;
        }
        .comment-text {
            margin-top: 10px; height: 25px;
            font-weight: bold; color: #D32F2F; font-size: 1.2rem;
        }

        .action-btn {
            margin-top: 20px; padding: 12px 30px;
            background: #FF7043; color: white; border: none;
            border-radius: 50px; font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem; cursor: pointer;
            border: 3px solid #5D4037;
            box-shadow: 4px 4px 0 #5D4037; /* Retro solid shadow */
            transition: transform 0.1s;
        }
        .action-btn:active { transform: translate(4px, 4px); box-shadow: 0 0 0; }

        /* --- STAGE 2: TRANSITION --- */
        .trans-msg {
            font-size: 2rem; text-align: center;
            color: #D32F2F; opacity: 0; transition: opacity 0.5s;
            max-width: 80%;
        }

        /* --- STAGE 3: MEMORY LANE (Polaroid Style) --- */
        .memory-container {
            width: 100%; max-width: 500px;
            padding: 40px 20px;
        }

        .polaroid {
            background: white;
            padding: 15px 15px 40px 15px; /* Bottom padding for caption */
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            transform: rotate(-2deg);
            margin-bottom: 50px;
            opacity: 0; transform: translateY(50px) rotate(-2deg);
            transition: all 0.8s ease;
            text-align: center;
            border: 1px solid #EEE;
        }
        .polaroid:nth-child(even) { transform: translateY(50px) rotate(2deg); }
        .polaroid.visible { opacity: 1; transform: translateY(0) rotate(-2deg); }
        .polaroid:nth-child(even).visible { transform: translateY(0) rotate(2deg); }

        .polaroid img {
            width: 100%; border-radius: 0; /* Square edges for polaroid look */
            border: 1px solid #EEE;
        }
        .date-tag {
            display: inline-block; background: #FFCCBC;
            padding: 2px 10px; font-size: 0.9rem;
            color: #5D4037; margin-top: 10px; font-weight: bold;
            transform: rotate(-5deg);
        }
        .caption { margin-top: 10px; font-size: 1.1rem; color: #555; }

        /* --- STAGE 4: PROPOSAL --- */
        .proposal-card {
            background: white; padding: 40px 20px;
            border-radius: 20px; text-align: center;
            border: 5px solid #FF8A80;
            max-width: 90%;
            box-shadow: 10px 10px 0 #FFCDD2;
        }
        .profile-pic {
            width: 150px; height: 150px; object-fit: cover;
            border-radius: 50%; border: 5px solid #FF7043;
            margin-bottom: 20px;
        }
        .btn-group {
            display: flex; gap: 20px; justify-content: center; margin-top: 30px;
            position: relative; height: 60px;
        }
        .yes-btn {
            background: #66BB6A; border-color: #33691E; color: white;
        }
        .no-btn {
            background: #EF5350; border-color: #B71C1C; color: white;
            position: absolute; /* Allows moving */
            transition: top 0.2s, left 0.2s;
        }
        /* Add this to the style section */
        .couple-photo {
            width: 150px;           /* Increased size */
            height: 150px;          /* Increased size */
            object-fit: cover;      /* Ensures image fills the box perfectly */
            border-radius: 20px;    /* Rounded corners (Soft Square) */
            border: 5px solid #E91E63; /* Cute Pink border */
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: block;
            margin-left: auto;
            margin-right: auto;
            background-color: white; /* Fallback if image loads slowly */}

    </style>
</head>
<body>

    <a href="../index.html" class="back-btn">‚Üê Home</a>
    <audio id="clap-sound" src="clap.mp3"></audio>

    <section id="stage-1" class="page-section active">
        <h1>Can you put us together? üß©</h1>
        
        <div class="puzzle-frame">
            <div class="puzzle-grid" id="grid">
                </div>
        </div>

        <div class="progress-box">
            <div class="progress-bar-bg">
                <div class="progress-bar-fill" id="progress"></div>
            </div>
            <div class="comment-text" id="comment">Let's start!</div>
        </div>

        <button class="action-btn" onclick="shuffleBoard()" style="background:#BCAAA4; margin-top:30px; font-size:1rem;">Reset Pieces</button>
    </section>

    <section id="stage-2" class="page-section">
        <div class="trans-msg" id="trans-text"></div>
    </section>

    <section id="stage-3" class="page-section">
        <h1>Our Journey ‚ú®</h1>
        <p style="margin-bottom: 30px;">(Scroll down)</p>

        <div class="memory-container">
            <div class="polaroid">
                <img src="mem1.jpg" alt="Memory 1"> <div class="date-tag">Day 1</div>
                <div class="caption">Where it all started. I knew you were special.</div>
            </div>

            <div class="polaroid">
                <img src="mem2.jpg" alt="Memory 2"> <div class="date-tag">Best Day</div>
                <div class="caption">That time we laughed until our stomachs hurt.</div>
            </div>

            <div class="polaroid">
                <img src="mem3.jpg" alt="Memory 3"> <div class="date-tag">Tough Times</div>
                <div class="caption">Even when things were hard, you stayed. Thank you.</div>
            </div>
        </div>

        <button class="action-btn" onclick="goToFinal()" style="margin-bottom: 50px;">One Final Step... ‚ù§Ô∏è</button>
    </section>

    <section id="stage-4" class="page-section">
        <div class="proposal-card">
            <img src="puzzle-image.jpg" class="profile-pic"> <h1>Will you be my Valentine Forever?</h1>
            <p style="font-size: 1.3rem;">And watch life unfold together, marrying me?</p>
            
            <div class="btn-group">
                <button class="action-btn yes-btn" onclick="sheSaidYes()">YES! üíç</button>
                <button class="action-btn no-btn" id="no-btn" onmouseover="moveNo()" ontouchstart="moveNo()">No</button>
            </div>
        </div>
    </section>
    <audio id="bg-music" loop>
    <source src="../assets/music.mp3" type="audio/mpeg"> </audio>

    <script>
        // --- CONFIG ---
        // Change these URLs to your actual image files in the pages folder
        // Example: 'puzzle-image.jpg'
        const puzzleImage = 'https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=400&auto=format&fit=crop'; 
        const comments = ["Good start!", "Perfect fit!", "Almost there!", "You're doing great!", "Just like us!", "Beautiful!", "Love it!", "Complete!"];

        // --- STATE ---
        let pieces = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        let shuffled = [];
        let draggedIdx = null;

        // --- ELEMENTS ---
        const grid = document.getElementById('grid');
        const progress = document.getElementById('progress');
        const comment = document.getElementById('comment');

        // --- PUZZLE LOGIC ---
        function shuffleBoard() {
            // Fisher-Yates Shuffle
            shuffled = [...pieces];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            renderGrid();
            updateProgress();
        }

        function renderGrid() {
            grid.innerHTML = '';
            shuffled.forEach((val, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';
                div.draggable = true;
                
                // Calculate background position based on the Original Value (val)
                // Grid is 3x3. Row = floor(val/3), Col = val%3
                const row = Math.floor(val / 3);
                const col = val % 3;
                div.style.backgroundImage = `url('${puzzleImage}')`;
                div.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
                
                // Correct position highlight
                if (val === index) {
                    div.style.border = "2px solid #66BB6A"; // Green hint
                    div.style.zIndex = 1;
                }

                // Drag Events
                div.addEventListener('dragstart', () => draggedIdx = index);
                div.addEventListener('dragover', (e) => e.preventDefault());
                div.addEventListener('drop', () => swapPieces(index));

                // Touch Events (Mobile)
                div.addEventListener('touchstart', (e) => {
                    draggedIdx = index;
                    // Prevent scrolling while touching a piece
                    // e.preventDefault(); 
                }, {passive: true});
                
                div.addEventListener('touchend', (e) => {
                    // Simple tap-to-swap mechanic for mobile is easier than drag
                    // Or implement complex touch drag. 
                    // Let's use a "Tap two to swap" for mobile robustness?
                    // Actually, let's try mapping drop target.
                    // For simplicity in this logic: Drop is tricky on mobile without massive code.
                    // Fallback: Click first, Click second to swap.
                    if (draggedIdx !== null && draggedIdx !== index) {
                        swapPieces(index);
                    }
                });

                grid.appendChild(div);
            });
        }

        function swapPieces(targetIdx) {
            if (draggedIdx === null) return;
            
            // Swap in array
            [shuffled[draggedIdx], shuffled[targetIdx]] = [shuffled[targetIdx], shuffled[draggedIdx]];
            
            draggedIdx = null;
            renderGrid();
            updateProgress();
        }

        function updateProgress() {
            let correct = 0;
            shuffled.forEach((val, idx) => {
                if (val === idx) correct++;
            });

            const pct = (correct / 9) * 100;
            progress.style.width = pct + '%';
            
            if (correct > 0 && correct < 9) {
                comment.innerText = comments[Math.floor(Math.random() * (comments.length - 1))];
            }

            if (correct === 9) {
                comment.innerText = "Completed! ‚ù§Ô∏è";
                setTimeout(finishPuzzle, 500);
            }
        }

        function finishPuzzle() {
            const sound = document.getElementById('clap-sound');
            if(sound) sound.play().catch(e => console.log("Audio auto-play blocked"));
            
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            setTimeout(() => {
                document.getElementById('stage-1').classList.remove('active');
                playTransitions();
            }, 2000);
        }

        // --- TRANSITIONS ---
        function playTransitions() {
            const stage2 = document.getElementById('stage-2');
            stage2.classList.add('active');
            const txt = document.getElementById('trans-text');
            
            const msgs = [
                "Congrats! üéâ",
                "I love your efforts ‚ù§Ô∏è",
                "Here is a gift from my side üéÅ",
                "Let's take a walk down memory lane..."
            ];

            let i = 0;
            function showNext() {
                if(i >= msgs.length) {
                    startMemoryLane();
                    return;
                }
                txt.style.opacity = 0;
                setTimeout(() => {
                    txt.innerText = msgs[i];
                    txt.style.opacity = 1;
                    i++;
                    setTimeout(showNext, 2000);
                }, 500);
            }
            showNext();
        }

        // --- MEMORY LANE ---
        function startMemoryLane() {
            document.getElementById('stage-2').classList.remove('active');
            document.getElementById('stage-3').classList.add('active');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('visible');
                });
            }, { threshold: 0.2 });

            document.querySelectorAll('.polaroid').forEach(p => observer.observe(p));
        }

        function goToFinal() {
            document.getElementById('stage-3').classList.remove('active');
            document.getElementById('stage-4').classList.add('active');
        }

        // --- PROPOSAL ---
        function moveNo() {
            const btn = document.getElementById('no-btn');
            // Move within the button group area roughly
            const x = (Math.random() * 200) - 100;
            const y = (Math.random() * 200) - 100;
            
            // Use transform to avoid breaking layout flow
            btn.style.transform = `translate(${x}px, ${y}px)`;
        }

        function sheSaidYes() {
            confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
            alert("YAY! I promise to make you the happiest! ‚ù§Ô∏èüíç");
        }

        // Init
        shuffleBoard();

    </script>
</body>
</html> 