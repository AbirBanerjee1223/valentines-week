<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Be My Valentine ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Patrick+Hand&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- GLOBAL THEME --- */
        body {
            margin: 0; padding: 0; font-family: 'Patrick Hand', cursive;
            background-color: #FFFDF5; color: #5D4037;
            overflow-x: hidden; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; -webkit-tap-highlight-color: transparent;
        }

        .back-btn {
            position: absolute; top: 20px; left: 20px;
            text-decoration: none; color: #D32F2F;
            background: white; border: 2px solid #FFCDD2;
            padding: 8px 15px; border-radius: 20px;
            font-weight: bold; z-index: 100; box-shadow: 3px 3px 0px #FFCDD2;
        }

        h1 {
            font-family: 'Fredoka', sans-serif; text-align: center; color: #D32F2F;
            margin: 10px 0 20px 0; font-size: 2.5rem;
        }

        /* --- SECTIONS --- */
        .page-section {
            display: none; width: 100%; min-height: 100vh;
            flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; box-sizing: border-box;
            opacity: 0; transition: opacity 1s ease;
        }
        .page-section.active { display: flex; opacity: 1; }

        /* --- STAGE 1: PUZZLE --- */
        .puzzle-frame {
            background: white; padding: 15px; border-radius: 15px;
            box-shadow: 0 10px 0 #E0E0E0; border: 4px solid #5D4037;
        }
        .puzzle-grid {
            display: grid; grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px);
            gap: 2px; background: #FFCDD2; border: 2px solid #5D4037;
        }
        .puzzle-piece {
            width: 100px; height: 100px;
            background-image: url('puzzle-image.jpg'); /* YOUR PHOTO */
            background-size: 300px 300px; cursor: grab; transition: transform 0.2s;
            background-color: #FF8A80;
        }
        .puzzle-piece:active { cursor: grabbing; transform: scale(1.05); z-index: 10; }

        .progress-box { width: 320px; margin-top: 25px; text-align: center; }
        .progress-bar-bg {
            width: 100%; height: 20px; background: #FFE0B2; border-radius: 10px;
            border: 2px solid #5D4037; overflow: hidden;
        }
        .progress-bar-fill { height: 100%; width: 0%; background: #FF7043; transition: width 0.3s; }
        .comment-text { margin-top: 10px; height: 25px; font-weight: bold; color: #D32F2F; font-size: 1.2rem; }

        .action-btn {
            margin-top: 20px; padding: 12px 30px; background: #FF7043; color: white; border: none;
            border-radius: 50px; font-family: 'Fredoka', sans-serif; font-size: 1.2rem; cursor: pointer;
            border: 3px solid #5D4037; box-shadow: 4px 4px 0 #5D4037; transition: transform 0.1s;
        }
        .action-btn:active { transform: translate(4px, 4px); box-shadow: 0 0 0; }

        /* --- STAGE 2: TRANSITION --- */
        .trans-msg { font-size: 2rem; text-align: center; color: #D32F2F; opacity: 0; transition: opacity 0.5s; max-width: 80%; }

        /* --- STAGE 3: MEMORY LANE --- */
        .memory-container { width: 100%; max-width: 500px; padding: 40px 20px; }
        .polaroid {
            background: white; padding: 15px 15px 40px 15px; box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            transform: rotate(-2deg); margin-bottom: 50px; opacity: 0; transform: translateY(50px) rotate(-2deg);
            transition: all 0.8s ease; text-align: center; border: 1px solid #EEE;
        }
        .polaroid:nth-child(even) { transform: translateY(50px) rotate(2deg); }
        .polaroid.visible { opacity: 1; transform: translateY(0) rotate(-2deg); }
        .polaroid:nth-child(even).visible { transform: translateY(0) rotate(2deg); }
        .polaroid img { width: 100%; border: 1px solid #EEE; }
        .date-tag {
            display: inline-block; background: #FFCCBC; padding: 2px 10px; font-size: 0.9rem;
            color: #5D4037; margin-top: 10px; font-weight: bold; transform: rotate(-5deg);
        }
        .caption { margin-top: 10px; font-size: 1.1rem; color: #555; }

        /* --- STAGE 4: PROPOSAL --- */
        .proposal-card {
            background: white; padding: 40px 20px; border-radius: 20px; text-align: center;
            border: 5px solid #FF8A80; max-width: 90%; box-shadow: 10px 10px 0 #FFCDD2;
        }
        /* Buttons aligned nicely */
        .btn-group {
            display: flex; justify-content: center; align-items: center; gap: 30px;
            margin-top: 30px; position: relative; width: 100%;
        }
        .yes-btn { background: #66BB6A; border-color: #33691E; color: white; z-index: 2; }
        .no-btn {
            background: #EF5350; border-color: #B71C1C; color: white;
            transition: transform 0.2s ease; z-index: 1;
        }

        /* --- STAGE 5: FINAL SUCCESS CARD --- */
        .success-card {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            border: 5px solid #E91E63; max-width: 320px; width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .couple-photo {
            width: 150px; height: 150px; object-fit: cover; border-radius: 20px;
            border: 5px solid #E91E63; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: block; margin-left: auto; margin-right: auto; background-color: white;
        }

    </style>
</head>
<body>

    <a href="../index.html" class="back-btn">‚Üê Home</a>
    <audio id="clap-sound" src="clap.mp3"></audio>

    <section id="stage-1" class="page-section active">
        <h1>Can you put us together? üß©</h1>
        Long press or drag the pieces to solve the puzzle and reveal a special memory of us! <br>(Hint: It's one of my favorite photos of us ‚ù§Ô∏è)
        
        <div class="puzzle-frame">
            <div class="puzzle-grid" id="grid"></div>
        </div>

        <div class="progress-box">
            <div class="progress-bar-bg"><div class="progress-bar-fill" id="progress"></div></div>
            <div class="comment-text" id="comment">Let's start!</div>
        </div>

        <button class="action-btn" onclick="shuffleBoard()" style="background:#BCAAA4; margin-top:30px; font-size:1rem;">Reset Pieces</button>
    </section>

    <section id="stage-2" class="page-section">
        <div class="trans-msg" id="trans-text"></div>
    </section>

    <section id="stage-3" class="page-section">
        <h1>Our Journey ‚ú®</h1>
        <p style="margin-bottom: 30px;">(Scroll down)</p>

        <div class="memory-container">
            <div class="polaroid">
                <img src="https://i.postimg.cc/tgXCSksM/IMG-20230909-WA0024.jpg" alt="Memory"> <div class="date-tag">The Beginning, Our First Photo</div>
                <div class="caption">Sei prothom planned berono.. bikele jhil par ee dariye golpo arr tor oi misti hasi ta akhono mone pore.. jantam oo na pore kichu hobe kina but akta feeling chole esechilo mone</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/vm38pn9H/IMG-20230913-WA0055.jpg" alt="Memory"> <div class="date-tag">First Date</div>
                <div class="caption">Ecopark er oi moja ta.. finally relationship ee asa ta.. and and let's not forget bristi te hat dhore dourano ta.. prothom thekei sob romantic hoye jacchilooo jeno...</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/431cwn2Z/IMG-20230924-WA0029.jpg" alt="Memory"> <div class="date-tag">Movie dekhte jawa</div>
                <div class="caption">Sukoon chilo sei din ta.. CC1 ee movie dekhte gechilam.. arr sei gate ee jigessa korlo \"Mam 18+ too\".. kotoi na hesechi ota bhebe.. jodio dekhte to cuteeee sa baccha ee lagchili.. hehe</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/qvmDCMHZ/IMG-20241112-205504.jpg" alt="Memory"> <div class="date-tag">First Durga Pujo timee</div>
                <div class="caption">Hehe ei din ta.. ake opor k dewa jama pore pujo pandel.. then church and finally princep ghat.. best ghora till now nki? Koto boroo plan chilo arr koto ee na happy feel korechilam purotar pore.. that romantic connection.. hayee</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/C5RfF7hL/IMG-20231213-WA0018.jpg" alt="Memory"> <div class="date-tag">My Birthday Celebration</div>
                <div class="caption">Hotat kore deke niye cake katiye nili bol arr janteo dili na oi jonno dakchis.. plus uk ota amr first time kono person oi bhabe amr bday manalo.. thanks love for every effort you made for me... it was the best experience I had...</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/QttFbmWk/IMG20231223135043.jpg" alt="Memory"> <div class="date-tag">Final date of the year at Victoria</div>
                <div class="caption">At one of the love places of kolkata, jekhane tor koto je cute moments dekhechilam.. christmas er lightning enjoy korechilam.. arr amra jani how much we enjoyed that day.. was very unique nischoi..</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/YSZXbn96/IMG-20241112-205611.jpg" alt="Memory"> <div class="date-tag">Cutie r birthday celebration</div>
                <div class="caption">Heheee tor first birthday.. amr khepu/santa r first birthday.. arr plan to onnk korechilam toke surprise dewar jonno kcihu ta success oo peyechilam maybe.. sob theke difficult chilo hocche oi same bus ee uthe surprise kora ta.. otar jonno 1.5 hrs dariyechilam ooo.. and then those reactions gift gulo peye.. sei octi then chocos.. I love giving surprises to youuu</div>
            </div>
            <div class="polaroid">
                <img src="https://i.postimg.cc/wx1Vxcbm/IMG20240426173651.jpg" alt="Memory"> <div class="date-tag">Arambagh er time</div>
                <div class="caption">Eta to kikore ee bhulbo ami yaar... lukiye karur jonno first time 3 hrs travel kore dekha korte gechilam.. and it was worth every effort.. sei kole sue mathai hat bolano ta.. I still crave otar jonno majhe majhei.. the most peaceful thing felt.. I love you..</div>
            </div>
            <div class="polaroid">
                <img src="../assets/mem9.jpeg" alt="Memory"> <div class="date-tag">Your biggest birthday celeration</div>
                <div class="caption">So much planning, so much love, so much joy. Planned purota and executed it. Pluss the efforts, pyar to karta hu.</div>
            </div>
            <div class="polaroid">
                <img src="../assets/mem10.jpg" alt="Memory"> <div class="date-tag">Bengali Dev hit with you</div>
                <div class="caption">Some of the most beautiful moments we've shared together. I still wait for more of them with you.</div>
            </div>
        </div>

        <button class="action-btn" onclick="goToFinal()" style="margin-bottom: 50px;">One Final Question... ‚ù§Ô∏è</button>
    </section>

    <section id="stage-4" class="page-section">
        <div class="proposal-card">
            <img src="https://i.postimg.cc/QttFbmWk/IMG20231223135043.jpg" class="couple-photo"> 
            
            <h1 style="font-size: 2.2rem; margin-bottom: 10px;">Will you be my Valentine Forever?</h1>
            <p style="font-size: 1.3rem;">And watch life unfold together, marrying me?</p>
            
            <div class="btn-group">
                <button class="action-btn yes-btn" onclick="sheSaidYes()">YES! üíç</button>
                <button class="action-btn no-btn" id="no-btn" onmouseover="moveNo()" ontouchstart="moveNo()">No</button>
            </div>
        </div>
    </section>

    <section id="stage-5" class="page-section">
        <div class="success-card">
            <img src="../assets/IMG-20250223-WA0059.jpg" class="couple-photo"> 
            <h1 style="color: #E91E63; margin-top: 10px;">YAY! You said YESSS! üíç</h1>
            <p style="font-size: 1.3rem; color: #555;">
                You just made me the happiest person alive.<br> Trust me I need you real badly. Please ja kore hok bas amar sathe future ta rakhis, I can't imagine life without you. <br>
                <b>I Love You!</b>
            </p>
            <div style="font-size: 3rem; margin-top: 15px;">‚ù§Ô∏è‚ú®</div>
        </div>
    </section>

    <audio id="bg-music" loop>
        <source src="../assets/music.mp3" type="audio/mpeg">
    </audio>

    <script>
        // --- CONFIG ---
        // REPLACE 'puzzle-image.jpg' with your actual image file inside pages folder
        const puzzleImage = '../assets/IMG-20250223-WA0059.jpg'; 
        const comments = ["Good start!", "Perfect fit!", "Almost there!", "Doing great!", "Just like us!", "Beautiful!", "Love it!", "Complete!"];

        // --- STATE & ELEMENTS ---
        let pieces = [0, 1, 2, 3, 4, 5, 6, 7, 8];
        let shuffled = [];
        let draggedIdx = null;
        const grid = document.getElementById('grid');
        const progress = document.getElementById('progress');
        const comment = document.getElementById('comment');

        // --- PUZZLE LOGIC ---
        function shuffleBoard() {
            shuffled = [...pieces];
            // Simple shuffle
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            renderGrid();
            updateProgress();
        }

        function renderGrid() {
            grid.innerHTML = '';
            shuffled.forEach((val, index) => {
                const div = document.createElement('div');
                div.className = 'puzzle-piece';
                div.draggable = true;
                const row = Math.floor(val / 3);
                const col = val % 3;
                div.style.backgroundImage = `url('${puzzleImage}')`;
                div.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
                
                if (val === index) {
                    div.style.border = "2px solid #66BB6A"; // Highlight correct
                    div.style.zIndex = 1;
                }

                div.addEventListener('dragstart', () => draggedIdx = index);
                div.addEventListener('dragover', (e) => e.preventDefault());
                div.addEventListener('drop', () => swapPieces(index));
                
                // Simple Touch Support
                div.addEventListener('touchstart', () => draggedIdx = index, {passive: true});
                div.addEventListener('touchend', () => {
                    if (draggedIdx !== null && draggedIdx !== index) swapPieces(index);
                });

                grid.appendChild(div);
            });
        }

        function swapPieces(targetIdx) {
            if (draggedIdx === null) return;
            [shuffled[draggedIdx], shuffled[targetIdx]] = [shuffled[targetIdx], shuffled[draggedIdx]];
            draggedIdx = null;
            renderGrid();
            updateProgress();
        }

        function updateProgress() {
            let correct = 0;
            shuffled.forEach((val, idx) => { if (val === idx) correct++; });
            const pct = (correct / 9) * 100;
            progress.style.width = pct + '%';
            
            if (correct > 0 && correct < 9) comment.innerText = comments[Math.floor(Math.random() * (comments.length - 1))];
            if (correct === 9) {
                comment.innerText = "Completed! ‚ù§Ô∏è";
                setTimeout(finishPuzzle, 500);
            }
        }

        function finishPuzzle() {
            const sound = document.getElementById('clap-sound');
            if(sound) sound.play().catch(e=>{});
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            setTimeout(() => {
                document.getElementById('stage-1').classList.remove('active');
                playTransitions();
            }, 2000);
        }

        // --- TRANSITIONS ---
        function playTransitions() {
            document.getElementById('stage-2').classList.add('active');
            const txt = document.getElementById('trans-text');
            const msgs = [
                "Congrats! üéâ", "I love your efforts ‚ù§Ô∏è", "Here is a gift from my side üéÅ", "Let's take a walk down memory lane..."
            ];
            let i = 0;
            function showNext() {
                if(i >= msgs.length) { startMemoryLane(); return; }
                txt.style.opacity = 0;
                setTimeout(() => {
                    txt.innerText = msgs[i];
                    txt.style.opacity = 1;
                    i++;
                    setTimeout(showNext, 2000);
                }, 500);
            }
            showNext();
        }

        // --- MEMORY LANE ---
        function startMemoryLane() {
            document.getElementById('stage-2').classList.remove('active');
            document.getElementById('stage-3').classList.add('active');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
            }, { threshold: 0.1 });
            document.querySelectorAll('.polaroid').forEach(p => observer.observe(p));
        }

        function goToFinal() {
            document.getElementById('stage-3').classList.remove('active');
            document.getElementById('stage-4').classList.add('active');
        }

        // --- PROPOSAL ---
        function moveNo() {
            const btn = document.getElementById('no-btn');
            // Move randomly but keep within reasonable view
            const x = (Math.random() * 200) - 100;
            const y = (Math.random() * 200) - 100;
            btn.style.transform = `translate(${x}px, ${y}px)`;
        }

        function sheSaidYes() {
            confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
            // Hide Proposal, Show Success Card
            document.getElementById('stage-4').classList.remove('active');
            document.getElementById('stage-5').classList.add('active');
        }

        shuffleBoard();
    </script>
</body>
</html>